@page
@{
    @model BL.Models.VM.ProductVM
}

<h2>Shop</h2>
<h3>Subscribe Notifications</h3>

<div id="notification-container"></div>
<div>
    <button id="btnStart" style="float:left">Start Notify</button>
    <button id="btnEnd" style="float:right">End Notify</button>
</div>
@section scripts {
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/3.1.10/signalr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" />
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("https://localhost:7231/notificationHub")
            .configureLogging(signalR.LogLevel.Information)
            .build();

       // connection.on("newProduct", (product) => {
      //      Toastify({
       //         text: "New Product" + product.productName,
      //          duration: 3000,
      //          close: true,
        //        gravity: "top",
       //         position: "right",
      //          backgroundColor: "linear-gradient(to right , #00b09b , #96c93d)",
      //      }).showToast();
      //  });
        btnStart.addEventListener("click" , (ev) => {
            connection.invoke("startNotify")
        });

        btnEnd.addEventListener("click" ,(ev) => {
            connection.invoke("endNotify")
        });
        connection.start()
            .then(function () {
                console.log("SignalR connection established.");

                connection.on("SendWithMessageAsync", function (data , message) {
                    // Обработка уведомления
                    console.log("Received notification:", data , message);
                    $("#notification-container").append("<p>New product added: " + message + data.productName + "</p>");
                    toastr.options.timeOut = 5000;
                    toastr.success(`New product added: ${message || ""} ${data.productName || ""}`);
                });
            })
            .catch(function (err) {
                console.error("Error during SignalR connection:", err);
            });

       
    </script>
}